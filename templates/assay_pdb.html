<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .toggle-link {
            color: #ffffff;
            background-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
        }

        .toggle-link:hover,
        .toggle-link.active {
            background-color: #0056b3;
        }
        #toggleLink2 {
            color: #ffffff;
            background-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
        }

        #toggleLink2:hover {
            background-color: #0056b3;
        }

        #content2.active {
            background-color: #ccc;
        }

        #toggleLink3 {
            color: #ffffff;
            background-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
        }

        #toggleLink3:hover {
            background-color: #0056b3;
        }

        #content3.active {
            background-color: #ccc;
        }
        #toggleLink4 {
            color: #ffffff;
            background-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
        }

        #toggleLink4:hover {
            background-color: #0056b3;
        }

        #content4.active {
            background-color: #ccc;
        }
        #content {
          /* 要顯示或隱藏的內容的樣式 */
          background-color: #f5f5f5;
          padding: 10px;
        }
        .center-text {
            text-align: center;
        }
        .table-align thead th {
            text-align: center;
        }

        .table-align tbody td {
            text-align: center;
        }
        .table-container {
                display: flex;
                justify-content: center;
        }
        .color-red {
            color: hotpink;
        }
        .color-blue {
            color: deepskyblue;
        }
        .background-red {
          background-color: hotpink;
          display: inline-block;
          padding: 2px 5px;
          border-radius: 3px;
        }
        .aa-group {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <h1>Details of <span class="color-red">{{ epitope }}</span></h1>
    {% load static %}
    <script type="text/javascript" src="{% static '/Jmol/jsmol/JSmol.min.js' %}"></script>
    <div style="display: flex; justify-content: space-between;">
        <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="summary-box" style="white-space: nowrap; overflow-x: auto;">
            <h2>SUMMARY</h2>
            <div class="table-container">
                <table class="table table-striped table-bordered table-condensed table-hover table-align">
                    <thead class="thead-dark">
                        <tr>
                            <th>Item</th>
                            <th>Info</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SAMPLE ID</td>
                            {% if epitope.tcellid %}
                            <td>{{ epitope.tcellid }}</td>
                            {% else %}
                            <td>{{ epitope.key }}</td>
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Pathogen Type</td>
                            <td>{{epitope.epitopespecies}}</td>
                        </tr>
                            <td>PubMedID</td>
                            <td>{{epitope.pmid}}</td>
                        </tr>
                        <tr>
                            <td>Assay</td>
                            <td>{{epitope.method}}</td>
                        </tr>
                        <tr>
                            <td>Gene</td>
                            <td>{{epitope.gene}}</td>
                        </tr>
                        <tr>
                            <td class="color-red">MHC (Old):</td>
                            <td>{{epitope.old_allele_name}}</td>
                        </tr>
                        {% if epitope.mhc_convert %}
                            <tr>
                            <td class="color-red">MHC (Convert):</td>
                            <td>{{epitope.mhc_convert}}</td>
                            </tr>
                        {% endif %}
                        <tr>
                            <td class="color-blue">TCR INFO:</td>
                            {% if epitope.VA_IMGT %}
                                <td>{{epitope.VA_IMGT}} | {{epitope.VB_IMGT}}</td>
                            {% else %}
                                <td>No TCR info found!ß</td>
                            {% endif %}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div style="width: 300px;">
            <script type="text/javascript">
            //var script_run = "load /jsmol/test.pdb;spin on;";
            //var script_run ="load {% static 'PDB/5JZI.pdb' %}; spin on;spacefill;";
            //var script_run = "load {% static 'PDB/'|add:pdbfile %};spin on;spacefill; select :{{ epitope_chain }};color red";
            var script_run = "load {% static 'PDB/' %}" + "{{ pdbfile }}" + "{{ command }}";
            console.log(script_run);
            var jmolApplet0;
            var Info0 = {
                width: 300,
                height: 300,
                color: "black",
                serverURL: "/jsmol/php/jsmol.php",
                use: "HTML5",
                jarPath: "{% static '/Jmol/jsmol/java' %}",
                j2sPath: "{% static '/Jmol/jsmol/j2s' %}",
                script: script_run, //The command defined before.
                disableInitialConsole: true
            }
            Jmol.getApplet("jmolApplet0", Info0)
            </script>
            <a href="javascript:Jmol.script(jmolApplet0,'spin on')" style="color: black;">spin on</a>
            <a href="javascript:Jmol.script(jmolApplet0,'spin off')" style="color: black;">spin off</a>
            <br>
            <a href="javascript:Jmol.script(jmolApplet0,'{{ show_pMHC_Command }}')" style="color: pink;">Only show pMHC</a>
            <a href="javascript:Jmol.script(jmolApplet0,'{{ show_TCR_Command }}')" style="color: lightblue;">Only show TCR</a>
            <br>
            <a href="javascript:Jmol.script(jmolApplet0,'restore STATE')" style="color: black;">Restore default status</a>
        </div>
    </div>
    <div>
        <a href="#" id="toggleLink" class="toggle-link">Structure information</a>
        <div id="content" style="display: none;">
            <!-- 要隱藏或顯示的內容 -->
            <div class="center-text">
                <h3>{{epitope.title}}</h3>
            </div>
            <div class="table-container">
                 <table class="table table-striped table-bordered table-condensed table-hover table-align">
                    <thead class="thead-dark">
                        <tr>
                            <th>Item</th>
                            <th>Info</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>PDBID</td>
                            <td>{{ epitope.pdbid }}</td>
                        </tr>
                        {% if epitope.clear %}
                        <tr>
                            <td>PDB ambiguity</td>
                            <td>本尊</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td>PDB ambiguity</td>
                            <td>不同pubmedID</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <td>PDB Date</td>
                            <td>{{ epitope.pdb_date }}</td>
                        </tr>
                        <tr>
                            <td>Bound State</td>
                            <td>{{ epitope.bound }}</td>
                        </tr>
                        <tr>
                            <td>Ag Chain</td>
                            <td>{{ epitope.Ag_Chain }}</td>
                        </tr>
                        <tr>
                            <td>MHC Chain</td>
                            <td>{{ epitope.MHC_Chain }}</td>
                        </tr>
                        <tr>
                            <td>TCR Chain</td>
                            <td>{{ epitope.VA_Chain }} | {{ epitope.VB_Chain }}</td>
                        </tr>
                        <tr>
                            <td>TCR IMGT</td>
                            <td>{{ epitope.VA_IMGT }} | {{ epitope.VB_IMGT }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <br>
        <br>
        <div>
            <a href="#" id="toggleLink2">Assay information</a>
            <div id="content2" style="display: none;">
                <div class="table-container">
                 <table class="table table-striped table-bordered table-condensed table-hover table-align">
                    <thead class="thead-dark">
                        <tr>
                            <th>Item</th>
                            <th>Info</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Method</td>
                            <td>{{ epitope.method }}</td>
                        </tr>
                        <tr>
                            <td>Response</td>
                            <td>{{ epitope.Response }}</td>
                        </tr>
                        <tr>
                            <td>Qualitative measurement</td>
                            <td>{{ epitope.qualitative }}</td>
                        </tr>
                        <tr>
                            <td>Quantitative measurement</td>
                            <td>{{ epitope.quantitative }}</td>
                        </tr>
                    </tbody>
                 </table>
                </div>
            </div>
        </div>
        <br>
        <br>
        <div>
            <a href="#" id="toggleLink3">Sequence information</a>
            <div id="content3" style="display: none;">
                <br>
                <br>
                <div class="table-container">
                 <table class="table table-striped table-bordered table-condensed table-hover table-align">
                    <thead class="thead-dark">
                        <tr>
                            <th>Chain Type</th>
                            <th>Chain ID</th>
                            <th>peptide/IMGT numbered seqeunce(CDR)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Antigen peptide</td>
                            <td>{{epitope.Ag_Chain}}</td>
                            <td>
                                <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="protein-sequence-viewbox" style="white-space: nowrap; overflow-x: auto;">
                                  {% for amino_acid in epitope_peptide %}
                                  <div class="aa-group" style="display: inline-block; white-space: normal;">
                                    <div><small>{{ forloop.counter }}</small></div>
                                    {% for aa in amino_acid %}
                                    <span>{{ aa }}</span>
                                    {% endfor %}
                                  </div>
                                  {% endfor %}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>MHC Chain : A</td>
                            <td>{{MHC_Chain1}}</td>
                            <td>
                                <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="protein-sequence-viewbox" style="white-space: nowrap; overflow-x: auto;">
                                  {% for amino_acid in MHC_seq1 %}
                                    {% if forloop.counter0|divisibleby:30 %}
                                      <br>  <!-- 在每10个元素后插入换行符 -->
                                    {% endif %}
                                    <div class="aa-group" style="white-space: normal;">
                                      <div><small>{{ forloop.counter }}</small></div>
                                      {% for aa in amino_acid %}
                                        <span>{{ aa }}</span>
                                      {% endfor %}
                                    </div>
                                  {% endfor %}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>MHC Chain : B</td>
                            <td>{{MHC_Chain2}}</td>
                            <td>
                                <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="protein-sequence-viewbox" style="white-space: nowrap; overflow-x: auto;">
                                  {% for amino_acid in MHC_seq2 %}
                                    {% if forloop.counter0|divisibleby:30 %}
                                      <br>  <!-- 在每10个元素后插入换行符 -->
                                    {% endif %}
                                    <div class="aa-group" style="white-space: normal;">
                                      <div><small>{{ forloop.counter }}</small></div>
                                      {% for aa in amino_acid %}
                                        <span>{{ aa }}</span>
                                      {% endfor %}
                                    </div>
                                  {% endfor %}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>TCR: VA</td>
                            <td>{{TCR_VA_Chain}}</td>
                            <td>
                                <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="protein-sequence-viewbox" style="white-space: nowrap; overflow-x: auto;">
                                  {% for amino_acid in TCR_VA_seq %}
                                    {% if forloop.counter0|divisibleby:30 %}
                                      <br>  <!-- 在每10个元素后插入换行符 -->
                                    {% endif %}
                                    <div class="aa-group" style="white-space: normal;">
                                      <div><small>{{ forloop.counter }}</small></div>
                                      {% for aa in amino_acid %}
                                        <span>{{ aa }}</span>
                                      {% endfor %}
                                    </div>
                                  {% endfor %}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>TCR: VB</td>
                            <td>{{TCR_VB_Chain}}</td>
                            <td>
                                <div class="row mx-0 mt-1 mb-3 p-3 border border-info rounded" id="protein-sequence-viewbox" style="white-space: nowrap; overflow-x: auto;">
                                  {% for amino_acid in TCR_VB_seq %}
                                    {% if forloop.counter0|divisibleby:30 %}
                                      <br>  <!-- 在每10个元素后插入换行符 -->
                                    {% endif %}
                                    <div class="aa-group" style="white-space: normal;">
                                      <div><small>{{ forloop.counter }}</small></div>
                                      {% for aa in amino_acid %}
                                        <span>{{ aa }}</span>
                                      {% endfor %}
                                    </div>
                                  {% endfor %}
                                </div>
                            </td>
                        </tr>
                 </table>
            </div>
        </div>
        <div>
            <br>
            <br>
            <a href="#" id="toggleLink4">不太一樣的peptide (80%)</a>
            <div id="content4" style="display: none;">
                <br>
                <br>
                <div class="table-container">
                    <table class="table custom-table">
                        <thead>
                            <tr>
                                <th>Epitope Sequence</th>
                                <th>MHC Ambiguity</th>
                                <th>Old Allele Name</th>
                                <th>MHC Convert</th>
                                <th>Epitope Species</th>
                                <th>DB Source</th>
                                <th>Sequence Alignment</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for epitope in alike_epitopes %}
                            <tr>
                                <td><a href="{% url 'assay_detail' pk=epitope.key %}" class="pmid-link">{{ epitope.sequence }}</a></td>
                                <td>{{ epitope.mhc_ambiguity }}</td>
                                <td>{{ epitope.old_allele_name }}</td>
                                <td>{{ epitope.mhc_convert }}</td>
                                <td>{{ epitope.epitopespecies}}</td>
                                <td>{{ epitope.dbsource}}</td>
                                <td>{{ epitope.Ag_Chain}}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">No epitopes found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            var toggleButton = document.getElementById("toggleLink");
            var content = document.getElementById("content");

            toggleButton.addEventListener("click", function() {
              if (content.style.display === "none") {
                content.style.display = "block";
              } else {
                content.style.display = "none";
              }
            });

            var toggleLink2 = document.getElementById("toggleLink2");
            var content2 = document.getElementById("content2");

            toggleLink2.addEventListener("click", function () {
                content2.style.display = (content2.style.display === "none") ? "block" : "none";
                toggleLink2.classList.toggle("active");
            });

            var toggleLink3 = document.getElementById("toggleLink3");
            var content3 = document.getElementById("content3");

            toggleLink3.addEventListener("click", function () {
                content3.style.display = (content3.style.display === "none") ? "block" : "none";
                toggleLink3.classList.toggle("active");
            });

            var toggleLink4 = document.getElementById("toggleLink4");
            var content4 = document.getElementById("content4");

            toggleLink4.addEventListener("click", function () {
                content4.style.display = (content4.style.display === "none") ? "block" : "none";
                toggleLink4.classList.toggle("active");
            });
        </script>
    </div>
</body>
</html>
